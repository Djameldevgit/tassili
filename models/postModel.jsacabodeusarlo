const mongoose = require('mongoose')

const postSchema = new mongoose.Schema({
    // üî∑ CAMPOS DEL SISTEMA BASE
    images: {
        type: Array,
        required: true
    },
    likes: [{ type: mongoose.Types.ObjectId, ref: 'user' }],
    user: { type: mongoose.Types.ObjectId, ref: 'user' },

    // üî∑ CATEGOR√çA Y SUBCATEGOR√çA
    category: String,
    subCategory: String,
    
    // üî∑ CONTACTO
    telefono: {
        type: String,
        default: "0658556296",
        validate: {
            validator: function(phone) {
                if (!phone) return true;
                return /^[\d+][\d\s-()]+$/.test(phone);
            },
            message: 'Formato de tel√©fono inv√°lido'
        }
    },
    
    // üî∑ INFORMACI√ìN B√ÅSICA
    title: String,
    description: String,
    content: String,
    
    // üî∑ PRECIO Y VENTA
    price: String,
    tipodemoneda: {
        type: String,
        default: "DA"
    },
    tipoventa: String,
    wilaya: String,
    commune: String,
    
    // üî∑ ESTADO GENERAL
    etat: String,
    
    // üî∑ CAMPOS COMUNES PARA TEL√âFONOS Y ACCESORIOS
    tipoArticulo: String,
    marque: String,
    modelo: String,
    referencia: String,
    capacite: String,
    colortelefono: String,
    copie: String,
    type_memoire: String,
    
    // üî∑ CAMPOS PARA SMARTPHONES
    os: String,
    appareil: String,
    camerafrontal: String,
    gigas: String,
    doublepuces: String,
    bateria: String,
    charging_type: String,
    
    // üî∑ OTROS CAMPOS ESPEC√çFICOS
    compatibiliteAccessoire: String,
    capaciteCarte: String,
    puissanceChargeur: String,
    typeConnexionAudio: String,
    typeConnexionFixFax: String,
    connectiviteManette: String,
    dureeOffre: String,
    etatPiece: String,
    capacitePowerbank: String,
    tailleEcranWatch: String,
    fonctionnalitesWatch: String,
    compatibiliteProtection: String,
    compatibiliteStylet: String,
    caracteristiquesStylet: String,
    compatibilite: String,
    tailleEcranTablette: String,
    etatTablette: String,
    marcacelular: String,
    marcaVR: String

}, {
    timestamps: true
})

// üî∑ √çNDICES PARA MEJOR PERFORMANCE
postSchema.index({ category: 1, subCategory: 1 })
postSchema.index({ user: 1, createdAt: -1 })
postSchema.index({ price: 1 })
postSchema.index({ marque: 1 })
postSchema.index({ etat: 1 })
postSchema.index({ tipoArticulo: 1 })

module.exports = mongoose.model('post', postSchema)