const mongoose = require('mongoose')

const postSchema = new mongoose.Schema({
    // ğŸ”· CAMPOS DEL SISTEMA BASE
    images: {
        type: Array,
        required: true
    },
    likes: [{ type: mongoose.Types.ObjectId, ref: 'user' }],
    user: { type: mongoose.Types.ObjectId, ref: 'user' },

    // ğŸ”· CATEGORÃA Y SUBCATEGORÃA
    category : String,
    subCategory: String,
    telefono: {
        type: String,
        default: "0658556296", // âœ… Cambiado a String y con valor por defecto
        validate: {
            validator: function(phone) {
                if (!phone) return true; // Permitir vacÃ­o (usarÃ¡ default)
                // Validar formato de telÃ©fono (nÃºmeros y + opcional)
                return /^[\d+][\d\s-()]+$/.test(phone);
            },
            message: 'Formato de telÃ©fono invÃ¡lido'
        }
    },
    // ğŸ”· INFORMACIÃ“N BÃSICA
    title: String,
    description: String,
    content: String,
    
    // ğŸ”· PRECIO Y VENTA
    price: String,
    tipodemoneda: {
        type: String,
        default: "DA"
    },
    tipoventa: String,
    wilaya: String,
    commune: String,
    // ğŸ”· CARACTERÃSTICAS GENERALES
    genero: String,
    etat: String,
    color: [],
    temporada: String,
    marca: String,
    material: String,
    estilo: String,
    
    // ğŸ”· BEBÃ‰S
      tipoArticulo: String,
    edadBebes: String,
    
    // ğŸ”· BIJOUX
    tipopiedra: String,
    tipomaterialbijoux: String,

  
    // ğŸ”· ZAPATOS MUJER
    alturatacon: String,
    tipodecierre: String,
    formadepunta: String,
    
    // ğŸ”· ZAPATOS HOMBRE
    tipodesuela: String,
    tipodecierre_hombre: String,
    
    // ğŸ”· COLOR Y TEMPORADA ADICIONAL
    tipocolor: String,
    ocasion: String,
    
    // ğŸ”· GAFAS
    tipodelente: String,
    anchopuente: String,
    langitudpatilla: String,
    
    // ğŸ”· RELOJES
    movimientoreloj: String,
    materialcorrea: String,
    resistenciaagua: String,
    funcionalidades: String,
    tiporeloj: String,
    
    // ğŸ”· SAC Y VALISE
    correa: String,
    tallasaco: String,
    tipodsangle: String,
    
    // ğŸ”· PROFESIONAL
    tipodelabata: String,
    sectordetrabajo: String,
    
    // ğŸ”· TALLA
    talla: []

}, {
    timestamps: true
})

// ğŸ”· ÃNDICES PARA MEJOR PERFORMANCE
postSchema.index({ category: 1, subCategory: 1 })
postSchema.index({ user: 1, createdAt: -1 })
postSchema.index({ price: 1 })
postSchema.index({ marca: 1 })
postSchema.index({ genero: 1 })
postSchema.index({ etat: 1 })
postSchema.index({ material: 1 })
postSchema.index({ temporada: 1 })

module.exports = mongoose.model('post', postSchema)